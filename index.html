<!doctype html>
<html lang = "en-US">
	<head>
		<title>Gwent Electron</title>
		<meta charset = "utf-8" />
		<meta name = "author" content = "Sundaram, Costa & Sylver. Updates by Cam Smith" />
		<meta name = "description" content = "Play the original Gwent minigame from The Witcher 3 in your browser! Includes cards from Hearts of Stone and Blood & Wine!" />
		<meta name = "keywords" content = "arun, sundaram, reynolds, costa, randompianist, sylver, romain, durban, programmer, gwent, tw3, witcher, card, game, gamedev, play" />
		<meta name = "viewport" content = "width=device-width, initial-scale=1.0" />
		<link rel = "icon" type = "image/x-icon" href = "images/favicon.ico" />
		<link rel = "stylesheet" type = "text/css" href = "css/style.css" />
		<style type = "text/css" id = "pLoad"></style>
	</head>
	<body>
		<div class = "abs" id = "very_start_bg1"></div>
		<div class = "abs" id = "very_start_gradient"></div>
		<div class = "abs" id = "very_start_bg2"></div>
		<div id = "very_start" class = "abs">
			<button class = "start-game_class" id = "button_start" style = "display:none">Play</button>
		</div>
		<div id = "dimensions"></div>

		<main style = "display:none">
			<section id = "click-background" class = "noclick"></section>
			<section id = "panel-left" class = "panel">
				<div id = "leader-op" class = "leader-box">
					<div class = "leader-container center"></div>
					<div class = "leader-active">
						<div></div>
					</div>
				</div>
				<section id = "stats-op" class = "stats">
					<div id = "faction-ability-op" class = "faction-ability">
						<div id = "faction-ability-count-op" class = "faction-ability-count">0</div>
					</div>
					<div class = "profile-img">
						<div>
							<div></div>
						</div>
					</div>
					<div id = "name-op" class = "name">Opponent</div>
					<div id = "deck-name-op" class = "deck-name"></div>
					<div id = "hand-count-op" class = "hand-count">6</div>
					<div id = "gem1-op" class = "gem gem-on bg-contain"></div>
					<div id = "gem2-op" class = "gem gem-on bg-contain"></div>
					<div id = "score-total-op" class = "score-total">
						<div class = "center">0</div>
					</div>
					<div id = "passed-op">Passed</div>
				</section>
				<div id = "weather" class = "card-container"></div>
				<section id = "stats-me" class = "stats">
					<div id = "faction-ability-me" class = "faction-ability">
						<div id = "faction-ability-count-me" class = "faction-ability-count">0</div>
					</div>
					<div class = "profile-img">
						<div>
							<div></div>
						</div>
					</div>
					<div id = "passed-me">Passed</div>
					<div id = "hand-count-me" class = "hand-count">5</div>
					<div id = "gem1-me" class = "gem gem-on bg-contain"></div>
					<div id = "gem2-me" class = "gem gem-on bg-contain"></div>
					<div id = "name-me" class = "name"></div>
					<div id = "deck-name-me" class = "deck-name"></div>
					<div id = "score-total-me" class = "score-total">
						<div class = "center">0</div>
					</div>
				</section>
				<div id = "leader-me" class = "leader-box">
					<div class = "leader-container center"></div>
					<div class = "leader-active">
						<div></div>
					</div>
				</div>
				<div id = "pass-button" class = "center botao-campo">Pass</div>
				<div id = "giveup-button" class = "center botao-campo">Surr.</div>
			</section>
			<section id = "panel-mid" class = "panel">
				<section id = "field-op" class = "field">
					<div class = "field-row">
						<div class = "row-score center">0</div>
						<div class = "row-special cardpile"></div>
						<div id = "f1" class = "row-cards card-container"></div>
						<div class = "row-weather"></div>
					</div>
					<div class = "field-row">
						<div class = "row-score center">0</div>
						<div class = "row-special cardpile"></div>
						<div id = "f2" class = "row-cards card-container"></div>
						<div class = "row-weather"></div>
					</div>
					<div class = "field-row">
						<div class = "row-score center">0</div>
						<div class = "row-special cardpile"></div>
						<div id = "f3" class = "row-cards card-container"></div>
						<div class = "row-weather"></div>
					</div>
				</section>
				<section id = "field-me" class = "field">
					<div class = "field-row">
						<div class = "row-score center">0</div>
						<div class = "row-special cardpile"></div>
						<div id = "f4" class = "row-cards card-container"></div>
						<div class = "row-weather"></div>
					</div>
					<div class = "field-row">
						<div class = "row-score center">0</div>
						<div class = "row-special cardpile"></div>
						<div id = "f5" class = "row-cards card-container"></div>
						<div class = "row-weather"></div>
					</div>
					<div class = "field-row">
						<div class = "row-score center">0</div>
						<div class = "row-special cardpile"></div>
						<div id = "f6" class = "row-cards card-container"></div>
						<div class = "row-weather"></div>
					</div>
				</section>
				<section id = "field-hand">
					<div id = "hand-row" class = "card-container card-selectable"></div>
					<div id = "op-hand-row" class = "card-container card-selectable"></div>
				</section>
			</section>
			<section id = "panel-right" class = "panel">
				<div id = "grave-op" class = "cardpile"></div>
				<div id = "deck-op" class = "cardpile"></div>
				<div id = "grave-me" class = "cardpile"></div>
				<div id = "deck-me" class = "cardpile"></div>
			</section>
			<div id = "hand-op"></div>
			<section class = "card-preview hide">
				<div class = "card-lg" id = "no_hover"></div>
				<div class = "card-description">
					<div></div>
					<h1></h1>
					<p></p>
				</div>
			</section>
			<section id = "carousel" class = "hide">
				<div>
					<div class = "card-lg" onclick = "Carousel.curr.shift(event,-2)"></div>
					<div class = "card-lg" onclick = "Carousel.curr.shift(event,-1)"></div>
					<div class = "card-lg" onclick = "Carousel.curr.select(event)" id = "no_sound"></div>
					<div class = "card-lg" onclick = "Carousel.curr.shift(event,1)"></div>
					<div class = "card-lg" onclick = "Carousel.curr.shift(event,2)"></div>
				</div>
				<div class = "card-description">
					<div></div>
					<h1></h1>
					<p></p>
				</div>
				<div id = "carousel_label"></div>
			</section>
			<section id = "popup" class = "center hide">
				<div>
					<h3></h3>
					<p></p>
					<div>
						<button class = "hover_un" onclick = "if (Popup.curr) Popup.curr.selectYes()"></button>
						<button class = "hover_un" onclick = "if (Popup.curr) Popup.curr.selectNo()"></button>
					</div>
				</div>
			</section>
			<section id = "notification-bar" class = "hide">
				<div></div>
			</section>
			<section id = "end-screen" class = "hide">
				<div></div>
				<table>
					<colgroup>
						<col span = "3" />
						<col span = "1" />
						<col span = "1" />
						<col span = "1" />
					</colgroup>
					<tbody>
						<tr>
							<th colspan = "2"></th>
							<th>Round 1</th>
							<th>Round 2</th>
							<th>Round 3</th>
						</tr>
						<tr>
							<th colspan = "2">You</th>
							<td>0</td>
							<td>0</td>
							<td>0</td>
						</tr>
						<tr>
							<th colspan = "2">Opponent</th>
							<td>0</td>
							<td>0</td>
							<td>0</td>
						</tr>
					</tbody>
				</table>
				<p class = "hide">The battle cannot end in a draw. You can play a rematch using the same decks or surrender.</p>
				<div class = "end-screen-buttons">
					<button id = "end-main-menu">Main Menu</button>
					<button id = "end-replay">Replay</button>
					<button onclick = "showStats(true)">Statistics</button>
				</div>
			</section>
			<section id = "deck-selector"></section>
		</main>
		<section id = "deck-customization" style = "display:none">
			<div id = "ai-difficulty-selector">
				<span>AI Difficulty: </span>
				<select id = "ai-difficulty-dropdown">
					<option value = "easy">Easy (80% optimal)</option>
					<option value = "medium" selected>Medium (90% optimal)</option>
					<option value = "hard">Hard (100% optimal)</option>
				</select>
			</div>
			<div id = "faction-title" class = "center">
				<h1></h1>
			</div>
			<div class = "search-container">
				<input type = "text" id = "card-search" class = "card-search-input" placeholder = "Search cards or keywords..." />
				<span id = "card-search-clear" class = "search-clear" style = "display: none;">×</span>
			</div>
			<p id = "faction-description"></p>
			<a id = "save-deck" class = "deck-options">Save Deck</a>
			<a id = "load-deck" class = "deck-options">Load Deck</a>
			<a id = "clear-deck" class = "deck-options">Clear Deck</a>
			<a id = "randomize-deck" class = "deck-options">Randomize Deck</a>
			<a id = "download-json" style = "display:none;"></a>
			<a id = "change-faction" class = "deck-options">Select Faction</a>
			<a id = "select-op-deck" class = "deck-options">Select Opponent Deck ></a>
			<span id = "op-deck-name" class = "deck-options">Random deck</span>
			<h2 id = "card-bank-title" class = "card-contianer-title">Card Collection</h2>
			<h2 id = "card-deck-title" class = "card-contianer-title">Cards in Deck</h2>
			<div id = "card-bank" class = "card-array"></div>
			<div id = "card-deck" class = "card-array"></div>
			<div id = "card-leader">
				<p>Leader</p>
				<div></div>
			</div>
			<div id = "deck-stats">
				<p>Total cards in deck</p>
				<p>0</p>
				<p>Number of Unit Cards</p>
				<p>0</p>
				<p>Special Cards</p>
				<p>0/10</p>
				<p>Total Unit Card Strength</p>
				<p>0</p>
				<p>Hero Cards</p>
				<p>0</p>
			</div>
			<button id = "start-game" class = "start-game_class">Start game</button>
			<button id = "start-ai-game" class = "start-game_class">Start AI game</button>
			<button id = "rules-button" class = "rules-button" onclick = "openRulesModal()">Rulebook</button>
		</section>
		<div id = "toggle-music" class = "center music-customization" style = "display:none">♫</div>
		<script type = "text/javascript" language = "JavaScript">
			// Initialize local music system when page loads
			window.addEventListener('load', function() {
				setTimeout(function() {
					if (typeof initLocalMusicSystem === 'function') {
						initLocalMusicSystem();
					}
					try { playIntroOnce(); } catch (e) {}
				}, 1000);
			});
		</script>
		<script type = "text/javascript" language = "JavaScript">
			// Play intro SFX once on load (tries intro.mp3, falls back to menu_opening.mp3)
			(function(){
				var introPlayed = false;
				window.playIntroOnce = function() {
					if (introPlayed) return;
					introPlayed = true;
					var srcIntro = 'sfx/intro.mp3';
					var srcFallback = 'sfx/menu_opening.mp3';
					try {
						if (window.electronAPI && window.electronAPI.getResourcePath) {
							srcIntro = window.electronAPI.getResourcePath(srcIntro);
							srcFallback = window.electronAPI.getResourcePath(srcFallback);
						}
					} catch (e) {}
					var audio = new Audio();
					audio.volume = 0.5;
					audio.src = srcIntro;
					audio.onerror = function(){
						this.onerror = null;
						this.src = srcFallback;
						this.play().catch(function(){});
					};
					audio.play().catch(function(){});
				}
			})();
		</script>
		<script type = "text/javascript" language = "JavaScript" src = "javascript/cards.js" defer></script>
		<script type = "text/javascript" language = "JavaScript" src = "javascript/decks.js" defer></script>
		<script type = "text/javascript" language = "JavaScript" src = "javascript/abilities.js" defer></script>
		<script type = "text/javascript" language = "JavaScript" src = "javascript/factions.js" defer></script>
		<script type = "text/javascript" language = "JavaScript" src = "javascript/deck-loader.js" defer></script>

		<!-- AI Difficulty Manager (load first) -->
		<script type = "text/javascript" language = "JavaScript" src = "javascript/ai-difficulty.js"></script>

		<script type = "text/javascript" language = "JavaScript" src = "javascript/gwent.js" defer></script>
		<script type = "text/javascript" language = "JavaScript" src = "javascript/statistics-tracker.js" defer></script>

		<script type = "text/javascript" language = "JavaScript">
			function goToMainMenu() {
				try {
					var es = document.getElementById("end-screen");
					es.style.opacity = 0;
					es.style.zIndex = 0;
					es.classList.add("hide");
				} catch (e) {}
				var mainEl = document.getElementsByTagName("main")[0];
				if (mainEl) mainEl.style.display = "none";
				var deckEl = document.getElementById("deck-customization");
				if (deckEl) {
					deckEl.style.display = "block";
					// Ensure table.jpg background is set
					deckEl.style.backgroundImage = "url('images/table.jpg')";
					deckEl.style.backgroundSize = "cover";
					deckEl.style.backgroundPosition = "center";
					deckEl.style.backgroundRepeat = "no-repeat";
				}
				var clickBg = document.getElementById("click-background");
				if (clickBg) clickBg.classList.remove("noclick");
			}
		</script>

		<!-- Bridge AI difficulty from Electron menu into AI config -->
		<script type = "text/javascript" language = "JavaScript">
			(function(){
				// Listen for difficulty changes from Electron menu and update UI
				if (window.electronAPI && window.electronAPI.onSetAIDifficulty) {
					window.electronAPI.onSetAIDifficulty((_, difficulty) => {
						try {
							// Update AI difficulty manager
							if (window.aiDifficultyManager) {
								window.aiDifficultyManager.setDifficulty(difficulty);
							}
							
							// Update dropdown to reflect change
							const dropdown = document.getElementById('ai-difficulty-dropdown');
							if (dropdown) {
								dropdown.value = difficulty;
							}
							
							// Legacy support
							if (window.AIConfigurationManager && window.AIConfigurationManager.updateConfig) {
								const type = (difficulty === 'hard') ? 'ENHANCED' : (difficulty === 'easy' ? 'BASIC' : 'AUTO');
								window.AIConfigurationManager.updateConfig('ai.type', type);
							}
							console.log('AI difficulty set to', difficulty);
						} catch (e) { /* no-op */ }
					});
				}
			})();
		</script>
		
		<!-- Rules Modal Overlay -->
		<div id = "rules-modal" class = "rules-modal-overlay" style = "display: none;">
			<div class = "rules-modal-content">
				<div class = "rules-modal-header">
					<h2>Rulebook</h2>
					<button class = "rules-close-btn" onclick = "closeRulesModal()">×</button>
				</div>
				<div class = "rules-modal-body">
					<iframe id = "rules-iframe" src = "rules.html" style = "width: 100%; height: 100%; border: none;"></iframe>
				</div>
			</div>
		</div>
		
		<script type = "text/javascript">
			function openRulesModal() {
				const modal = document.getElementById("rules-modal");
				if (!modal) return;
				modal.style.display = "flex";
				setTimeout(() => {
					modal.classList.add("show");
				}, 10);
				// Prevent body scroll when modal is open
				document.body.style.overflow = "hidden";
			}
			
			function closeRulesModal() {
				const modal = document.getElementById("rules-modal");
				if (!modal) return;
				modal.classList.remove("show");
				setTimeout(() => {
					modal.style.display = "none";
					document.body.style.overflow = "";
				}, 300);
			}
			
			// Initialize event listeners when DOM is ready
			document.addEventListener("DOMContentLoaded", function() {
				const modal = document.getElementById("rules-modal");
				if (modal) {
					// Close modal when clicking outside the content
					modal.addEventListener("click", function(e) {
						if (e.target === this) {
							closeRulesModal();
						}
					});
				}
				
				// Close modal with Escape key
				document.addEventListener("keydown", function(e) {
					if (e.key === "Escape") {
						const modal = document.getElementById("rules-modal");
						if (modal && modal.style.display !== "none") {
							closeRulesModal();
						}
					}
				});
			});
		</script>
	</body>
</html>